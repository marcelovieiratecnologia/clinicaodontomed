    {% extends 'adminlte/base.html' %}

{% load meus_filtros %}

{% block title %}
    Cadastro de Entrada/Saida
{% endblock %}

{% include 'adminlte/_scripts.html' %} <!-- Include para funcionar o JS -->


{% block content %}
<div class="box box-primary">
    <div class="box-header box-body">
        <h1 class="box-title">Cadastro de Entrada e Saídas</h1>
    </div>
</div>

<div class="box box-success">
    <div class="box-body">

        <form id="myForm" method="POST">

            {% csrf_token %}

            <div class="row">
                <div class="form-group col-md-2">
                    {{ form_entrada_saida.erros }}
                    <label>Dt Movimentação: </label>
                        {{ form_entrada_saida.dt_movimentacao|addclass:'form-control' }}
                </div>
                <div class="form-group col-md-3">
                    {{ form_entrada_saida.tp_entrada.erros }}
                    <label>Entrada/Saída: </label>
                        {{ form_entrada_saida.tp_entrada|addclass:'form-control' }}
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-8">
                    {{ form_entrada_saida.paciente.erros }}
                    <label>Nome do Paciente: </label>
                        {{ form_entrada_saida.paciente|addclass:'form-control' }}
                </div>
            </div>
            <div class="row">
        <!--Vai ficar fora pq estou trazendo o COMBO BOX-->
        <!--        <div class="form-group col-md-6">-->
        <!--            {{ form_entrada_saida.profissional.erros }}-->
        <!--            <label>Nome do Profissional: </label>-->
        <!--                {{ form_entrada_saida.profissional|addclass:'form-control' }}-->
        <!--        </div>-->
                <div class="form-group col-md-6">
                    {{ form_entrada_saida.fkprofissional.erros }}
                    <label>Profissional: </label>
                        {{ form_entrada_saida.fkprofissional|addclass:'form-control' }}
                </div>
                <div class="form-group col-md-2">
                    {{ form_entrada_saida.fkespecialidades.erros }}
                    <label>Especialidade: </label>
                        {{ form_entrada_saida.fkespecialidades|addclass:'form-control' }}
                </div>


<!--                <div class="form-group col-md-2">-->
<!--                    {{ form_entrada_saida.fkespecialidades.erros }}-->
<!--                    <label>Especialidade: </label>-->
<!--                        {{ fkespecialidades }}-->
<!--                </div>-->

                    <div class="form-group col-md-4">
                        {{ form_entrada_saida.fkespecialidades.erros }}
                        <label for="fkespecialidades">Especialidades:</label>
                        <select id="fkespecialidades" name="fkespecialidades" class="form-control">

<!--                            {% if especialidade  %}-->
<!--                                <option value="{{ especialidade.pk }}">{{ especialidade }}</option> &lt;!&ndash; Nesse IF Carrego o combo com a especialidade que foi salva no banco &ndash;&gt;-->
<!--                            {% else %}-->
<!--                                <option>Primeiro escolha o Profissional</option>  &lt;!&ndash; Se por algum motivo esta vindo sem especialidade traz o texto dizendo para escolher &ndash;&gt;-->
<!--                            {% endif %}-->

<!--                            {% for especialidade in id_fkespecialidades %}-->
<!--                            <option value="{{ especialidade.pk }}">{{ especialidade }}</option> &lt;!&ndash; Esse FOR vai preencher o combo com as especialidades relacionadas com o profissional &ndash;&gt;-->
<!--                            {% endfor %}-->

                            {% for especialidade in id_fkespecialidades %}
                            <option value="{{ especialidade.pk }}">{{ especialidade }}</option> <!-- Esse FOR vai preencher o combo com as especialidades relacionadas com o profissional -->
                            {% endfor %}

                        </select>
                    </div>

            </div>

            <div class="row">
                <div class="form-group col-md-12">
                {{ form_entrada_saida.motivo.erros }}
                <label>Motivo: </label>
                    {{ form_entrada_saida.motivo|addclass:'form-control' }}
                </div>
            </div>
            <div class="row">

                <div class="form-group col-md-1">
                    {{ form_entrada_saida.qt_parcelas.erros }}
                    <label>Parcelas: </label>
                        {{ form_entrada_saida.qt_parcelas|addclass:'form-control' }}
                </div>
                <div class="form-group col-md-3">
                    {{ form_entrada_saida.valor_entr_saida.erros }}
                    <label>Vlr Entrada: </label>
                        {{ form_entrada_saida.valor_entr_saida|addclass:'form-control' }}
                </div>
                <div class="form-group col-md-3">
                    {{ form_entrada_saida.tp_convenio.erros}}
                    <label>Convênio: </label>
                        {{ form_entrada_saida.tp_convenio|addclass:'form-control' }}
                </div>
            </div>
            <div class="row">

                <div class="form-group col-md-3">
                    {{ form_entrada_saida.tp_pagamento.erros }}
                    <label>Pagamento: </label>
                        {{ form_entrada_saida.tp_pagamento|addclass:'form-control' }}
                </div>
                <div class="form-group col-md-3">
                    {{ form_entrada_saida.tp_credito.erros }}
                    <label>Crédito: </label>
                        {{ form_entrada_saida.tp_credito|addclass:'form-control' }}
                </div>
                <div class="form-group col-md-2">
                    {{ form_entrada_saida.tp_porcentagem.erros }}
                    <label>Porcentagem: </label>
                        {{ form_entrada_saida.tp_porcentagem|addclass:'form-control' }}
                </div>
            </div>
            <div class="row">

                <div class="form-group col-md-12">
                    {{ form_entrada_saida.observacao.erros }}
                    <label>Observação: </label>
                        {{ form_entrada_saida.observacao|addclass:'form-control' }}
                </div>
            </div>

            <div class="form-group">
                <input class="btn btn-primary" type="submit" value="Salvar">
                <a href="{{request.META.HTTP_REFERER}}" class="btn btn-success">Cancelar</a>
            </div>

        </form>
    </div>
</div>

<!--  Teste Com o Atriibuto sendo passado na contrução do form , deu certo , porém tiver que deixar o form como POST e usar o AJAX com GET para não atrapalhar  -->
<!--            <form id="myFormSelect"-->
<!--                  method="GET"-->
<!--                  class="form-inline"-->
<!--                  data-url="{% url 'listar_especialidades_profissional' %}"-->
<!--            >-->
<!--                    <div class="row">-->

<!--                        <div class="form-group col-md-4" style="padding:10px;">-->
<!--                            <label for="idprofissional">Profissionais Select</label>-->
<!--                            <select id="idprofissional" class="form-control">-->
<!--                                <option {% for profissional in form_entrada_saida.fkprofissional %}> {{ profissional }} </option>-->
<!--                                {% endfor %}-->

<!--                            </select>-->
<!--                        </div>-->

<!--                        <div class="form-group col-md-4" style="padding:10px;">-->
<!--                            <label for="idespecialidadeselect">Especialidades Select</label>-->
<!--                            <select id="idespecialidadeselect" class="form-control">-->
<!--                                <option>-&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</option>-->
<!--                            </select>-->
<!--                        </div>-->

<!--                    </div>-->

<!--            </form>-->


{% block js %}
<script>

<!--/*Estava usando com o atribuito URL no form, porem estava tendo problemas , fiz outro abaixo passando a URL no AJAX-->
<!--    $("#idprofissional").change(function(){-->
<!--        let url = $('#myFormSelect').data('url');-->
<!--        let idprofissional  = $(this).val();-->
<!--        $.ajax({-->
<!--            url: url,-->
<!--            data: {-->
<!--                idprofissional: idprofissional-->
<!--            },-->
<!--            success: function(response){-->
<!--                $('#idespecialidadeselect').html(response);-->
<!--            }-->
<!--        });-->
<!--    });*/-->

$(document).ready(function(){
        let id_fkprofissional = $(this).val();
        var btn = document.getElementById("id_fkprofissional");
        console.log('ola')
        console.log(btn)
        $.ajax({
            url: "{% url 'listar_especialidades_profissional' %}",
            type: 'GET',
            data: {
                id_fkprofissional: id_fkprofissional
            },
            success: function(response){
            console.log(response)
                $('#id_fkespecialidades').html(response)
            }
        })
});

    $('#id_fkprofissional').change(function(){
        let id_fkprofissional = $(this).val();
        $.ajax({
            url: "{% url 'listar_especialidades_profissional' %}",
            type: 'GET',
            data: {
                id_fkprofissional: id_fkprofissional
            },
            success: function(response){
            console.log(response)
                $('#id_fkespecialidades').html(response)
            }
        })
    });

</script>
{% endblock js %}

{% endblock content %}